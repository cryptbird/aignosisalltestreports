<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Patient Data</title>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
	<style>
		body {
			font-family: Arial, sans-serif;
			margin-top: 0;
			padding: 180px;
            margin: 10px 0 !important; /* Ensure margins are applied on all pages */
            /* padding: 0; */
		}

		.container {
			width: 100%;
			max-width: 7.5in;
			/* Ensure it fits within the PDF width (8.5in - margins) */
			/* margin: auto; */
			overflow: hidden;
			/* Prevent content overflow */
			word-wrap: break-word;
			/* Wrap long text */
		}

		.data-field {
			margin-bottom: 10px;
			font-size: 16px;
		}

		.label {
			font-weight: bold;
		}

		#printBtn {
			margin-top: 20px;
			padding: 10px 20px;
			background-color: #007bff;
			color: #fff;
			border: none;
			border-radius: 5px;
			cursor: pointer;
		}

		#printBtn:hover {
			background-color: #0056b3;
		}

		#chartContainer {
			margin-top: 40px;
			max-width: 7.5in;
			/* Match container width */
			overflow-x: auto;
			/* Allow scrolling for wide charts */
		}

        #chartContainermchat {
			margin-top: 40px;
			max-width: 7.5in;
			/* Match container width */
			overflow-x: auto;
			/* Allow scrolling for wide charts */
		}

		.pageheadline {
			padding-bottom: 15px;
			font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
				Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue",
				sans-serif;
			font-weight: 600;
			font-size: large;
		}

		.reportheading {
			font-size: 30px;
			font-family: "Times New Roman", Times, serif;
			font-weight: 900;
			margin-top: 50px;
			margin-left: 25px;
			margin-right: 25px;
		}

		.reportcontent {
			margin: 25px;
			font-size: 15px;
			color: #000;
			font-family: "Times New Roman", Times, serif;
			font-weight: 600;
			line-height: 25px;
		}
		.scorecontent {
			margin: 25px;
			font-size: 12px;
			color: #727a98;
			font-family: "Times New Roman", Times, serif;
			font-weight: 600;
			line-height: 15px;
		}	
		#contentToPrint {
			/* background-color: #FFDDDD; */
			/* Light pink background */
			padding: 20px;
			/* Add padding for better spacing */
            margin: 10px 0 !important; /* Add space before and after pages */
            /* padding: 10px;  */
            page-break-inside: avoid; /* Avoid cutting content in between */
		}
        .pagebreak {
            page-break-before: always; /* Force a new page */
        }
		/* Desktop mode for mobile */
		@media only screen and (max-width: 767px) {
			.container {
				width: 1024px;
			}
            body {
        margin: 10px 0 !important; /* Ensure margins are applied on all pages */
        padding: 0;
    }

    #contentToPrint {
        margin: 10px 0 !important; /* Add space before and after pages */
        padding: 10px; 
        page-break-inside: avoid; /* Avoid cutting content in between */
    }

    .pagebreak {
        page-break-before: always; /* Force a new page */
    }
		}
	</style>
</head>

<body>


    <!-- -------------------ISAA REPORT CONTENT STARTS------------------- -->
<center>
	<button id="printBtn">Print PDF</button>
</center>

	<div id="contentToPrint" style="margin: 0; padding: 10">
        <div id="ISAA">
		<div style="display: flex; border-bottom: 5px solid #ab29b9;">
			<div>
				<div class="pageheadline" style="border-bottom: 0; font-size: small;" id="pageheadlinedate"> .</div>
				<div class="pageheadline" style="display: flex;">Detailed ISAA Report</div>
			</div>
			<div style="margin-left: auto; margin-right: 0; ">
				<div style=" height: 60px;">

					<img src="aignosislogo.png" style="max-height:150%; max-width:150%;" alt="">

				</div>
			</div>
		</div>
		<div class="reportheading">
			<span style="color: #9b00ab">ISAA </span>Screening:
		</div>
		<div class="reportcontent">
			The Indian Scale for Assessment of Autism (ISAA) is a standardized tool designed to evaluate autism spectrum disorder (ASD) in children. It assesses social, emotional, communication, behavioral, sensory, and cognitive aspects through structured observations and parent interviews. The ISAA score helps determine the severity of autism, categorizing it as mild, moderate, or severe. A higher score indicates more pronounced autism-related challenges. It is widely used in clinical, research, and diagnostic settings in India.
			<br />
			The system provides outputs as <span id="isaaInterpretationmessage" style="font-size: 15px; color: #007bff;"></span>
			<br />
		</div>
		<span style="
          color: #9b00ab;
          font-family: 'Times New Roman', Times, serif;
          font-size: 20px;
          font-weight: 600;
		  margin-left: 25px;
        ">
			Detailed Psychology Report
		</span>
		<br />
		<span style="
          font-family: 'Times New Roman', Times, serif;
          font-size: 12px;
          font-weight: 600;
		  margin-left: 25px;
        ">
			Summary of Domain Specific Challenges
		</span>
		<br />
		
		<center>
		<div class="container" id="contentToPrint">
			<!-- <h1>Patient Information</h1> -->
			<div id="patientData" hidden>
				<!-- Data will be displayed here -->
			</div>

			<div id="chartContainer">
				<!-- <h2>Percentage Chart</h2> -->
				<canvas id="barChart"></canvas>
			</div>
		</div>
		
        <table border="4" style="width: 50%; text-align: center; margin-top: 20px;">
            <tr>
                <th>Score Range</th>
                <th>Classification</th>
            </tr>
            <tr>
                <td>&lt; 70</td>
                <td>Normal</td>
            </tr>
            <tr>
                <td>70 - 105</td>
                <td>Mild Autism</td>
            </tr>
            <tr>
                <td>106 - 153</td>
                <td>Moderate Autism</td>
            </tr>
            <tr>
                <td>&gt; 153</td>
                <td>Severe Autism</td>
            </tr>
        </table>
        
    </center>
	<div class="scorecontent">
		The Aignosis ISAA test output was: <span id='isaascore' style="font-size: xx-large; color: #007bff;"></span> <br>
		<!-- 0% developmental score - maximally neurotypical score. A score of 100% developmental challenge is achieved if the most neurotypical response is selected for each relevant question in
		this domain. <br>
		100%, developmental score = maximally atypical score. A score of 100%. developmental challenge is achieved if the most atypical response is selected for each relevant question in this
		domain. <br> -->
	</div>	
    </div>

<script>
		

	// Function to get URL parameters
	function getURLParameter(name) {
		const urlParams = new URLSearchParams(window.location.search);
		return urlParams.get(name);
	}

	// Function to display the data
	function displayData() {
		const patientData = {
			patientId: getURLParameter("patient_id"),
			socialResponsiveness:
				parseFloat(getURLParameter("social_response")) || 0,
			emotionalResponsiveness:
				parseFloat(getURLParameter("emotional_response")) || 0,
			speechRecognition:
				parseFloat(getURLParameter("speech_recognition")) || 0,
			behaviouralPattern:
				parseFloat(getURLParameter("behaviour_pattern")) || 0,
			sensoryAspects: parseFloat(getURLParameter("sensory_aspect")) || 0,
			cognitiveComponent: parseFloat(getURLParameter("cognitive")) || 0,
			TOT_ISAA:parseFloat(getURLParameter("TOT_ISAA")) || 0,
			isaaInterpretation:getURLParameter("isaaInterpretation") || 0,
		};

		const patientDataContainer = document.getElementById("patientData");
		for (const [key, value] of Object.entries(patientData)) {
			const fieldDiv = document.createElement("div");
			fieldDiv.classList.add("data-field");
			fieldDiv.innerHTML = `<span class="label">${key
				.replace(/([A-Z])/g, " $1")
				.toUpperCase()}:</span> ${value || "N/A"}`;
			patientDataContainer.appendChild(fieldDiv);
		}

		// Generate bar chart
		createBarChart(patientData);
		const currentDate = new Date().toLocaleString();
		document.getElementById('pageheadlinedate').innerHTML = currentDate;
		document.getElementById('isaascore').innerHTML = patientData.TOT_ISAA;
		document.getElementById('isaaInterpretationmessage').innerHTML = patientData.isaaInterpretation;
	}
	
	// Function to create a horizontal bar chart
	function createBarChart(data) {
		const labels = [
			"Social Responsiveness",
			"Emotional Responsiveness",
			"Speech Recognition",
			"Behavioural Pattern",
			"Sensory Aspects",
			"Cognitive Component",
		];

		const values = [
			data.socialResponsiveness,
			data.emotionalResponsiveness,
			data.speechRecognition,
			data.behaviouralPattern,
			data.sensoryAspects,
			data.cognitiveComponent,
		];

		const ctx = document.getElementById("barChart").getContext("2d");
		new Chart(ctx, {
			type: "bar",
			data: {
				labels: labels,
				datasets: [
					{
						label: "Percentage",
						data: values,
						backgroundColor: [
							"#93ef93",
							"#8bd0fa",
							"#fffe35",
							"#bc81f6",
							"#f7a000",
							"#cbcbcb",
						],
						borderColor: [
							"rgba(75, 192, 192, 1)",
							"rgba(54, 162, 235, 1)",
							"rgba(255, 206, 86, 1)",
							"rgba(153, 102, 255, 1)",
							"rgba(255, 159, 64, 1)",
							"rgba(201, 203, 207, 1)",
						],
						borderWidth: 1,
					},
				],
			},
			options: {
				indexAxis: "y", // This reverses the axes
				scales: {
					x: {
						beginAtZero: true,
						max: 100,
					},
				},
			},
		});
	}

	// Call the function to display data once the page loads
	// window.onload = displayData;

	// Add functionality to the Print PDF button
	document
		.getElementById("printBtn")
		.addEventListener("click", function () {
			const element = document.getElementById("contentToPrint");
			const options = {
				margin: [0, 0, 0, 0], // No margins
				filename: "patient_data.pdf",
				image: { type: "jpeg", quality: 0.98 },
				html2canvas: {
					scale: 2, // Higher scale for better quality
					width: element.offsetWidth, // Use container width
				},
				jsPDF: { unit: "in", format: "letter", orientation: "portrait" },
			};
			html2pdf()
				.set({
					html2canvas: { scrollX: 0, scrollY: 0 },
				})
				.from(element)
				.save();
		});
  
</script>
<!-- -------------------ISAA REPORT CONTENT ENDS------------------- -->
<!-- <br><br><br> -->
 <br> <br><br><br>
<!-- <div class="pagebreak"></div> -->
<!-- -------------------mchat REPORT CONTENT STARTS ----------------- -->
<div id="MCHAT">
        <div style="display: flex; border-bottom: 5px solid #ab29b9;">
            <div>
                <div class="pageheadline" style="border-bottom: 0; font-size: small;" id="pageheadlinedatemchat"> .</div>
                <div class="pageheadline" style="display: flex;">Detailed M-CHAT Report</div>
            </div>
            <div style="margin-left: auto; margin-right: 0; ">
                <div style=" height: 60px;">

                    <img src="aignosislogo.png" style="max-height:150%; max-width:150%;" alt="">

                </div>
            </div>
        </div>
        <div class="reportheading">
            <span style="color: #9b00ab">M-CHAT </span>Report:
        </div>
        <div class="reportcontent">
            
            The M-CHAT (Modified Checklist for Autism in Toddlers) is a widely used screening tool designed to identify early signs of autism spectrum disorder (ASD) in children aged 16 to 30 months. This assessment evaluates critical developmental domains such as social interaction, communication skills, and behavioral patterns, helping to detect potential risk factors for autism at an early stage.
            <br>
            The M-CHAT score provides a structured analysis of the child's responses, categorizing them into low, medium, or high risk for ASD. The system generates an overall risk assessment based on the child's responses to key questions, which focus on joint attention, pretend play, response to name, and social engagement.
            <br>
            The results include a risk classification indicator, which helps determine whether a child exhibits typical development, mild concerns requiring follow-up, or significant risk necessitating further evaluation. Early identification through M-CHAT allows for timely interventions, improving long-term developmental outcomes. <BR>
            
    <span id="MCHATscore" style="font-size: 35px; color: #007bff;"></span>
        </div>
        <span style="
        color: #9b00ab;
        font-family: 'Times New Roman', Times, serif;
        font-size: 20px;
        font-weight: 600;
        margin-left: 25px;
        ">
            Detailed M-CHAT Report
        </span>
        <br />
        <span style="
        font-family: 'Times New Roman', Times, serif;
        font-size: 12px;
        font-weight: 600;
        margin-left: 25px;
        ">
            Summary of Domain Specific Challenges
        </span>
        
        <!-- Patient Information Table -->
        <center>
            <table border="2" style="width: 50%; text-align: center; margin-top: 20px; border-collapse: collapse;">
                <tr>
                    <th style="padding: 10px; background-color: #94059f; color: white;">Field</th>
                    <th style="padding: 10px; background-color: #94059f; color: white;">Value</th>
                </tr>
                <tr>
                    <td style="padding: 8px; border: 1px solid #ccc;">Name</td>
                    <td style="padding: 8px; border: 1px solid #ccc;" id="patientNamecell">_</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border: 1px solid #ccc;">MCHAT Score</td>
                    <td style="padding: 8px; border: 1px solid #ccc;" id="mchatScorecell">_</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border: 1px solid #ccc;">Chronological Age</td>
                    <td style="padding: 8px; border: 1px solid #ccc;" id="chronologicalAgecell">_</td>
                </tr>
            </table>
        </center>
        <div class="scorecontent">
            <p>The Aignosis M-CHAT test output provides an assessment of the child's developmental patterns based on their responses to key screening questions.</p>
            
            <p>
                <strong>Lower M-CHAT Score:</strong> A lower score indicates that the child's responses align closely with typical developmental milestones, suggesting a minimal likelihood of autism spectrum disorder (ASD). In this case, the child exhibits expected social communication, interaction, and behavioral patterns. This means that the child's development is progressing in a way that is generally considered neurotypical.
            </p>
            
            <p>
                <strong>Higher M-CHAT Score:</strong> A higher score suggests that the child's responses indicate a greater number of atypical behaviors or developmental delays, which may be associated with autism spectrum disorder. This means that the child may face challenges in areas such as communication, eye contact, social engagement, and behavioral flexibility. A high score does not confirm a diagnosis of autism but serves as an early indicator that further evaluation by a specialist may be necessary.
            </p>
        
            <p>
                The M-CHAT screening tool is designed to help identify children who may require additional assessment and intervention at an early stage. Early detection and timely intervention can play a crucial role in supporting a child's developmental needs and improving long-term outcomes.
            </p>
        </div>
        
        

        <!-- <span style="font-family: 'Times New Roman', Times, serif; margin-left: 25px;">
            Lower scores indicate high Challenges
        </span> -->
        <center>
        <div class="container" id="contentToPrint">
            <!-- <h1>Patient Information</h1> -->
            <div id="patientData" hidden>
                <!-- Data will be displayed here -->
            </div>

            <div id="chartContainermchat">
                <!-- Display query parameters instead of the bar chart -->
                <!-- <h2>Query Parameters</h2> -->
                <div id="queryParameters"></div>
            </div>
        </div>
        </center>


    

    </div>
</div>
    <script>
    // Function to format numbers to 1 decimal place
    function formatToOneDecimal(value) {
        return parseFloat(value).toFixed(1);
    }
    
    // List of M-CHAT questions
    const mchatQuestions = [
        "Does your child enjoy being swung, bounced on your knee, etc.?",
        "Does your child take an interest in other children?",
        "Does your child like climbing on things, such as up stairs?",
        "Does your child enjoy playing peek-a-boo/hide-and-seek?",
        "Does your child ever pretend, for example, to talk on the phone or take care of dolls, or pretend other things?",
        "Does your child ever use his/her index finger to point, to ask for something?",
        "Does your child ever use his/her index finger to point, to indicate interest in something?",
        "Can your child play properly with small toys (e.g., cars or bricks) without just mouthing, fiddling, or dropping them?",
        "Does your child ever bring objects over to you (parent) to show you something?",
        "Does your child look you in the eye for more than a second or two?",
        "Does your child ever seem oversensitive to noise? (e.g., plugging ears)",
        "Does your child smile in response to your face or your smile?",
        "Does your child imitate you? (e.g., you make a faceâ€”will your child imitate it?)",
        "Does your child respond to his/her name when you call?",
        "If you point at a toy across the room, does your child look at it?",
        "Does your child walk?",
        "Does your child look at things you are looking at?",
        "Does your child make unusual finger movements near his/her face?",
        "Does your child try to get your attention to his/her own activity?",
        "Have you ever wondered if your child is deaf?",
        "Does your child understand what people say?",
        "Does your child sometimes stare at nothing or wander with no purpose?",
        "Does your child look at your face to check your reaction when faced with something unfamiliar?"
    ];

    // Function to display M-CHAT responses
    function displayMChatResponses() {
        const urlParams = new URLSearchParams(window.location.search);
        const queryContainer = document.getElementById("queryParameters");

        let mchatTable = `<table border="2" style="width: 100%; text-align: left; border-collapse: collapse;">
            <tr>
                <th style="padding: 10px; background-color: #94059f; color: white;">Question</th>
                <th style="padding: 10px; background-color: #94059f; color: white;">Response</th>
            </tr>`;

        for (let i = 1; i <= 23; i++) {
            let response = urlParams.get(`MCHAT_${i.toString().padStart(2, '0')}`) || "N/A"; // Fetch response for MCHAT_01, MCHAT_02, ..., MCHAT_23
            mchatTable += `
            <tr>
                <td style="padding: 8px; border: 1px solid #ccc;">${mchatQuestions[i - 1]}</td>
                <td style="padding: 8px; border: 1px solid #ccc; color: #94059f;">${response}</td>
            </tr>`;
        }

        mchatTable += `</table>`;

        queryContainer.innerHTML = mchatTable;
    }
    // Function to check and hide MCHAT section if needed
    function handleMChatVisibility() {
        const urlParams = new URLSearchParams(window.location.search);
        const mchatValue = urlParams.get("MCHAT");

        if (mchatValue === "Negative") {
            document.getElementById("MCHAT").style.display = "none"; // Hide the MCHAT section
        }
    }
    function handleISAAVisibility() {
        const urlParams = new URLSearchParams(window.location.search);
        const ISAAValue = urlParams.get("ISAA");

        if (ISAAValue === "Negative") {
            document.getElementById("ISAA").style.display = "none"; // Hide the ISAA section
        }
    }
    // Update on page load
    window.onload = () => {
        handleMChatVisibility();
        handleISAAVisibility();
        displayMChatResponses();
        displayData();
        // displayQueryParameters();

        // Set test score and classification MCHATscore with 1 decimal formatting
        const urlParams = new URLSearchParams(window.location.search);
        
    
        // Extract data from URL
        const patientName = urlParams.get("Name") || "N/A";
        const mchatScore = urlParams.get("MCHATscore") || "N/A";
        const chronologicalAge = urlParams.get("Age") || "N/A";
        // Populate the table
        console.log(patientName);
        document.getElementById("patientNamecell").innerHTML = patientName;
        document.getElementById("mchatScorecell").innerHTML = mchatScore;
        document.getElementById("chronologicalAgecell").innerHTML = chronologicalAge+" Years";
        const MCHATscore = formatToOneDecimal(urlParams.get("MCHATscore") || 0);
        const classification = urlParams.get("dq") || "N/A";
        const formattedClassification = isNaN(classification) ? classification : formatToOneDecimal(classification);
    const currentDate = new Date().toLocaleString();
    document.getElementById('pageheadlinedatemchat').innerHTML = currentDate;
        document.getElementById('MCHATscore').innerHTML = MCHATscore;
        // document.getElementById('classificationmessage').innerHTML = formattedClassification;
    };

    </script>



</body>

</html>